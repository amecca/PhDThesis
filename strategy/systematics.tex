\section{Systematic uncertainties}
\label{sec:systematics}
The imperfect knowledge of the detector response and of the experimental conditions, as well as the limited precision of fixed-order theoretical calculations concur in increasing the uncertainty on the results.
The effects of these unknowns are accounted for as \textit{systematic uncertainties}, which are then included as nuisance parameter in the model used to perform the statistical analysis and extract the results (Section \ref{sec:statistical_analysis}).

The systematic uncertainties can have different effects.
\textit{Normalization} uncertainties affect the normalization of processes, changing the event yield.
\textit{Shape} uncertainties, in addition, modify the physical observables (\eg kinematics) of the events, and result in a different distribution of the event fraction in the histogram bins.

Systematics can be divided, depending on their source, into \textit{theoretical} uncertainties, related to theory hypotheses and features of the numerical computations, and \textit{experimental} uncertainties, which depend on the knowledge of the detector response, running conditions, and include the data-driven estimation of background processes.
A detailed description of the various sources considered in this analysis follows.

\subsection{Theoretical uncertainties}
Theoretical uncertainties arise from the choice of the Parton Distribution Function (PDF) set,
the uncertainty on the strong coupling constant $\alpha_s$ and
the renormalization and factorization QCD scales, which account for the missing higher order uncertainty in finite order perturbative calculations.
The uncertainty on the PDF set has a shape effect on the transverse momentum of the photon
and on the ``MVA shape'' described in Section~\ref{sec:strategy_description}.
The effects of \alpS and of the missing higher orders are limited to the normalization for all of the variables considered.

The missing higher order uncertainty is estimated by considering, for each event, the effect
of varying the renormalization and factorization scales, $\mu_R$ and $\mu_F$,
around a central value $\mu_0$ in the range $0.5\mu_0 < \mu_{R,F} < 2\mu_0$
with the constraint that $0.5 < \mu_R/\mu_F < 2$.
Each of these variation results in a different weight for the event.
The effect of this uncertainty is estimated by taking the envelope of these weights.

The uncertainty on the proton PDF are calculated using the PDF4LHC prescription~\cite{Butterworth:2015oua,Alekhin:2011sk}.
Both the PDF and the \alpS uncertainties are accounted for by changing the
weight of each event according to the values calculated by the matrix element
generator and stored in the sample.

\subsection{Experimental uncertainties}
The uncertainty on the integrated luminosity varies from 1.2\usep\% to 2.5\usep\% in the data-taking years, and the total uncertainty for \RunII{} is 1.6\usep\%.
The luminosity measurements are carried out by experts within the collaboration according to the methodology described in Reference~\cite{CMS-LUM-17-003},
for each year of data-taking~\cite{CMS-LUM-17-004, CMS-LUM-18-002}.

%% The uncertainty on lepton identification and reconstruction efficiency has an effect on the overall event yield ranging from 1 to 15\usep\%.

The uncertainties coming from the data-driven estimation of fake lepton and fake photons backgrounds are also considered.
In both cases, the main contributions arise from the mismatch in background composition between the region in which the fake rate is measured and the regions where it its applied.
Additionally, in the case of the photon fake rate, the application region itself is statistically limited, and this introduces an additional uncertainty on the normalization of the fake photon process.

The effects of the lepton and photon efficiencies, the \pileup{} reweight (Section~\ref{sec:simulation})
and the L1 prefiring (Section~\ref{sec:L1Prefiring})
are determined by scaling up or down by one standard deviation the associated weight for each event,
and evaluating the impact on the normalization.
The effect of the variation of lepton and photon fake rates is propagated through the
respective formulas to scale the events accordingly.
For the photon energy scale, the threshold effect on the photon transverse momentum cut
is also taken into account.

The uncertainty on the the electron and muon efficiency scale factors
result in shifts of the order of~3\usep\% and~0.3\usep\% respectively.
%% for $\PZ\PZ\PGg$ and $\PQq\PQq/\Pg\Pg\to\PZ\PZ$.
The photon efficiency scale factors, both for the cut-based and the MVA IDs,
produce an uncertainty in the yield of approximately~1.1--1.3\usep\%.
The photon energy scale and resolution have negligible effects.
The \Lone prefiring discussed in Section~\ref{sec:L1Prefiring}
results in a normalization effect of approximately 0.2\usep\%.

When the prediction of the \nonprompt photon background is taken from simulation,
an additional uncertainty is applied to the normalization of the MC sample.
This uncertainty is estimated by comparing the photon fake rate in data in the $\PZ+{\rm L}$ region,
after the subtraction of prompt photon from simulation,
and the fake rate calculated on events with no generated prompt photon in the sample $\PQq\PAQq\to\PZ\PZ$.
The difference, which is approximately 35\usep\%, is applied as a
log-normal (see Section~\ref{sec:statistical_analysis}) uncertainty correlated among the data-taking periods on the normalization
of the $\PQq\PAQq/\Pg\Pg\to\PZ\PZ\to4\Pl({+}\PGg_\text{NP})$ components.

No trigger-associated uncertainty is applied since the \pt selection applied for electrons and muons
is harder than the online trigger threshold.
This ensures that the charged leptons offline momentum is at the plateau of efficiency.
The experimental systematics only affect the normalization,
except for the photon MVA efficiency scale factors for the variable ``MVA shape''.

A summary of the effect of the systematic uncertainties on the normalization
of the signal and main background samples in the four lepton channel is reported in Table~\ref{tab:syst_norm_effect}.
Note that the table reports also the impact of theoretical uncertainties
(\ie as QCD scale, PDF variation and \alpS) on the normalization of the signal sample.
However this effect must not be taken into account when the parameter of interest is the
signal yield itself (or a proxy such as the signal strength modifier),
and the values are reported merely for completeness.

\begin{table}
  \caption{
    Effect of the various systematics (in \%)
    on the normalization of the signal and main background samples,
    as well as the \nonprompt lepton and photon data-driven estimates,
    in the signal region of the four lepton channel.
    The selection used for the photon is the Loose working point of the cut-based ID.
  }
  \label{tab:syst_norm_effect}
  \centering
  \newcommand{\fn}[1]{\hyperlink{tab:syst_norm_effect:fn#1}{\ensuremath{{}^#1}}}
  \renewcommand{\arraystretch}{1.05}
  \begin{tabular}{l >{$}c<{$} >{$}c<{$} >{$}c<{$} >{$}c<{$}}
    \toprule
    & \PZ\PZ\PGg \to 4\Pl & \PZ\PZ \to 4 \Pl & \text{Fake}\ \Pl & \text{Fake}\ \PGg \\
    \midrule
    PDF variation       & {+}0.83/{-}3.17\fn1 & {+}2.58/{-}3.10 & -               & - \\
    QCDscale            & {+}9.91/{-}10.0\fn1 & {+}3.81/{-}3.91 & -               & - \\
    \alpS               &\text{negligible}\fn1& {+}0.72/{-}1.07 & -               & - \\
    L1 prefiring        & {-}0.51/{+}0.51 & {-}0.49/{+}0.49 & -               & - \\
    Electron efficiency & {+}2.73/{-}2.73 & {+}2.74/{-}2.74 & {+}4.27/{-}4.27 & {+}1.42/{-}1.42 \\
    Electron fake rate  & -               & -               & {+}6.42/{-}6.42 & - \\
    Muon efficiency     & {+}0.60/{-}0.60 & {+}0.60/{-}0.60 & {+}0.35/{-}0.35 & {+}0.66/{-}0.66 \\
    Muon fake rate      & -               & -               & {+}5.83/{-}5.83 & - \\
    Photon energy scale & {+}0.08/{-}0.13 & {+}0.15/{-}0.10 &\text{negligible}&\text{negligible}\\
    Photon efficiency   & {+}1.26/{-}1.26 & {+}1.33/{-}1.33 & {+}0.97/{-}0.97 & - \\
    Photon fake rate    & -               & -               & -               & {+}13.0/{-}12.3\fn2 \\
    \Pileup{} weight    & {-}1.59/{+}2.48 & {-}1.61/{+}2.10 & -               & - \\
    \bottomrule
    \noalign{\vspace{1ex}} % small vertical space
    \multicolumn{5}{l}{
      \footnotesize
      \parbox{.95\textwidth}{
        \hypertarget{tab:syst_norm_effect:fn1}{1}:
        The normalization effect of the theoretical uncertainties is not applied on the signal,
        since it would be degenerate with the signal strength modifier.
        }
    } \\
    \noalign{\vspace{1ex}}
    \multicolumn{5}{l}{
      \footnotesize
      \parbox{.95\textwidth}{
        \hypertarget{tab:syst_norm_effect:fn2}{2}:
        The normalization uncertainty used when \nonprompt photons are estimated from the
        simulation is the estimated by comparing the fake rate measured in data and the one calculated in simulation.
      }
    } \\
  \end{tabular}
\end{table}

\begin{table}
  \caption{
    Effect of the various systematics (in \%)
    on the normalization of the signal and main background samples,
    as well as the \nonprompt lepton and photon data-driven estimates,
    in the triboson fiducial region of the four lepton channel.
    The selection used for the photon is the Loose working point of the cut-based ID.
  }
  \label{tab:syst_norm_effect_FSRcut}
  \centering
  \renewcommand{\arraystretch}{1.05}
  \begin{tabular}{l >{$}c<{$} >{$}c<{$} >{$}c<{$} >{$}c<{$}}
    \toprule
    & \PZ\PZ\PGg \to 4\Pl & \PZ\PZ \to 4 \Pl & \text{Fake}\ \Pl & \text{Fake}\ \PGg \\
    \midrule
    L1 prefiring        & {-}0.58/{+}0.58 & {-}0.56/{+}0.56 & -               & - \\
    PDF variation       & {+}1.62/{-}3.12 & {+}2.70/{-}2.88 & -               & - \\
    QCDscale            & {+}9.45/{-}9.21 & {+}3.80/{-}3.84 & -               & - \\
    \alpS               &\text{negligible}& {+}0.50/{-}0.81 & -               & - \\
    Electron efficiency & {+}2.55/{-}2.55 & {+}2.47/{-}2.47 & {+}3.24/{-}3.24 & {+}1.07/{-}1.07 \\
    Electron fake rate  & -               & -               & {+}3.23/{-}3.23 & - \\
    Muon efficiency     & {+}0.57/{-}0.57 & {+}0.57/{-}0.57 & {+}0.43/{-}0.43 & {+}0.51/{-}0.51 \\
    Muon fake rate      & -               & -               & {+}3.00/{-}3.00 & - \\
    Photon energy scale & {+}0.14/{-}0.07 & {+}0.07/{-}0.12 &\text{negligible}&\text{negligible}\\
    Photon efficiency   & {+}1.19/{-}1.19 & {+}1.32/{-}1.32 & {+}1.00/{-}1.00 & - \\
    Photon fake rate    & -               & -               & -               & {+}13.24/{-}12.40 \\
    \Pileup{} weight    & {-}2.02/{+}2.70 & {-}1.38/{+}1.31 & -               & - \\
    \bottomrule
  \end{tabular}
\end{table}
